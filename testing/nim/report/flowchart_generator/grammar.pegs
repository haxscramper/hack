document <- block+
block <- ( stmt )+
stmt <-
     cond_stmt /
     for_loop /
     while_loop /
     assgn ";" /
     expr ";" /
     ( "{" ws ( stmt ws?  )* ws "}" )

end_stmt <- ws ( stmt ws / ";" ws )

if_stmt <- "if" ws "(" ws (expr ws)? ")" end_stmt
else_stmt <- "else" ws !"if" end_stmt
elif_stmt <- "else" ws "if" ws "(" ws (expr ws)? ")" end_stmt
cond_stmt <- if_stmt elif_stmt* else_stmt?
for_loop <- "for" ws "(" assgn? ";" ws_expr? ";" ws_expr? ")" end_stmt
while_loop <- "while" ws "(" ws_expr? ")" end_stmt


call <- ident "(" (ws_expr ("," ws_expr)* )? ")"
assgn <-
      ident ws "=" (!";" _)+ /
      ident ws ident ws "=" (!";" _)+

ws_expr <- ws (expr ws)?

meth_call <- primary ( "." ( call / ident ) )+
primary <- ident / call
expr <- literal /
     ident op2 expr /
     unop ident /
     ident unop /
     assgn /
     call /
     meth_call /
     "(" ws expr ws ")" /
     ident

op2 <- ws ( binop / relop / logop ) ws
binop <- ws ( "+" / "-" / "*" / "/") ws
relop <- ws ( "<" / ">" / "==" / "!=" ) ws
unop <- ws ( "--" / "++" ) ws
logop <- ws ( "||" / "&&" ) ws

literal <- strlit / intcon

strlit <- ws "\"" ( "\\\"" / ( !"\"" .))* "\"" ws
ident <- ws {\ident} ws
intcon <- ws \d+ ws

ws <- \s*
